---
title: "Practical Machine Learning Coursera Course - project"
date: "Sunday, November 22, 2015"
---

# Executive summary

This document is the project for a Coursera class: Practical Machine Learning. It uses the personal activity data taken by personal devices such as Jawbone Up, Nike FuelBand, and Fitbit. The goal of this project is to use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants and analyze/predict data taken when performing barbell lifts correctly and incorrectly in 5 different ways, Specifically, to predict the manner in which they did the exercise.


System info:

```{r message=FALSE, warning=FALSE}
Sys.info()[1:2]
R.version.string
```

# Data 

The training data for this project are available here: 

- https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv

- contains sensor data and execution type data

The test data are available here:

- https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv

- contains sensor data

The aim is to make prediction algorithm trained on the data from the pml-training.csv file to predict the execution type in the pml-testing.csv data file.

# Loading and exploring data

We can see that there are 19622 observations and 160 observed variables. ALso from the bellow we can see that variables contain the name of a sensor (_belt,  _arm, _dumbbell, _forearm). Second column shows the name of the watched person, the last column contains the values A to E, which show the classe type = the manner in which they did the exercise. This sais that not all the variables are generated by the sensors.

```{r message=FALSE, warning=FALSE}
training_data <- read.table("pml-training.csv", header = TRUE, sep = ",", na.strings = c("NA", "#DIV/0!"))

dim(training_data)
head(names(training_data), 8)
head(names(training_data), 3)

```

Data needed for the prediction model and removing NA values.

```{r message=FALSE, warning=FALSE}

column_names = grep(pattern = "_belt|_arm|_dumbbell|_forearm", names(training_data))
data = training_data[, c(column_names,160)]

na_data = is.na(data)
na_cols = which(colSums(na_data) > 19000)
data = data[, -na_cols]

```

# Algorithm

## Split data into training (75%) and testing sets.

```{r message=FALSE, warning=FALSE}
library(caret)
set.seed(1234)

inTrain <- createDataPartition(y=data$classe, p=0.75, list=FALSE)
training <- data[inTrain,]
testing <- data[-inTrain,]

```

## Making predictor

Random forest is used to fit the predictor to the training set.

```{r message=FALSE, warning=FALSE}
library(randomForest)

randForest <- randomForest(classe~., data=training)
randForest
```
The resulting predictor has a low OOB (out-of-bag) error estimate. The confusion matrix indicates that the predictor is accurate on that set.

## Testing

Appling model on the testing sample (not the special testing set) to get an estimate of out of sample error.

```{r message=FALSE, warning=FALSE}
predictionTest1 <- predict(randForest, newdata = testing, type = "class")
confusionMatrix(predictionTest1, testing$classe)
```
Accuracy and the Cohen’s kappa indicator of concordance show that the predictor has a low out of sample error rate.

## Testing on the special data test and preparing files for submission 
```{r message=FALSE, warning=FALSE}
testing_final <- read.csv("pml-testing.csv", na.strings=c("NA","#DIV/0!",""))
predictionTest2 <- predict(randForest, testing_final, type = "class")

files = function(x){
     n = length(x)
     for(i in 1:n){
         name = paste0("problem_id_",i,".txt")
         write.table(x[i],file=name,quote=FALSE,row.names=FALSE,col.names=FALSE)
     }
 }
files(predictionTest2)
```
# Appendix

```{r message=FALSE, warning=FALSE}
varImpPlot(randForest)

plot(randForest)
```
